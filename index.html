<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Cadastro com Firebase</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase App (o core do Firebase) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <!-- Firebase Firestore -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <!-- Firebase Auth -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="config.js"></script>
    <style>
        :root {
            --verde: #00802b;
            --amarelo: #FFCC00;
            --azul: #0066CC;
            --branco: #FFFFFF;
            --cinza-claro: #f8f9fa;
            --cinza-escuro: #e9ecef;
            --sombra: 0 4px 20px rgba(0, 0, 0, 0.08);
            --borda: 1px solid rgba(0, 0, 0, 0.08);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Poppins', 'Segoe UI', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, var(--verde) 0%, var(--azul) 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            background: var(--branco);
            border-radius: 16px;
            box-shadow: var(--sombra);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(to right, var(--verde), var(--azul));
            color: var(--branco);
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        
        h1 {
            font-size: 26px;
            font-weight: 600;
            color: var(--branco);
        }
        
        h2 {
            font-size: 22px;
            margin-bottom: 20px;
            color: var(--azul);
            position: relative;
            padding-bottom: 10px;
        }
        
        h2:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50px;
            height: 3px;
            background: var(--amarelo);
            border-radius: 3px;
        }
        
        nav {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        nav a {
            color: var(--branco);
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 6px;
            transition: all 0.3s;
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        nav a:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }
        
        .content {
            padding: 30px;
        }
        
        .card {
            background: var(--branco);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--sombra);
            border: var(--borda);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--azul);
        }
        
        input, textarea, select {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 15px;
            transition: all 0.3s;
            background: var(--cinza-claro);
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--azul);
            box-shadow: 0 0 0 3px rgba(0, 103, 204, 0.1);
        }
        
        button {
            background: var(--azul);
            color: var(--branco);
            border: none;
            padding: 14px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        button:hover {
            background: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 103, 204, 0.2);
        }
        
        .btn-delete {
            background: #dc3545;
        }
        
        .btn-delete:hover {
            background: #bb2d3b;
        }
        
        .btn-edit {
            background: var(--amarelo);
            color: #333;
        }
        
        .btn-edit:hover {
            background: #e6b800;
        }
        
        .btn-info {
            background: var(--verde);
        }
        
        .btn-info:hover {
            background: #006622;
        }
        
        .btn-backup {
            background: #6f42c1;
        }
        
        .btn-export {
            background: #fd7e14;
        }
        
        .btn-save {
            background: #198754;
        }
        
        .btn-cancel {
            background: #6c757d;
        }
        
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 20px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--sombra);
        }
        
        th, td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        th {
            background: var(--azul);
            color: var(--branco);
            font-weight: 500;
        }
        
        tr:nth-child(even) {
            background-color: rgba(0, 157, 59, 0.05);
        }
        
        tr:hover {
            background: rgba(0, 103, 204, 0.03);
        }
        
        .mensagem {
            padding: 16px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
            font-weight: 500;
        }
        
        .sucesso {
            background: #d4edda;
            color: #0f5132;
            border: 1px solid #badbcc;
        }
        
        .erro {
            background: #f8d7da;
            color: #842029;
            border: 1px solid #f5c2c7;
        }
        
        .alerta {
            background: #fff3cd;
            color: #664d03;
            border: 1px solid #ffecb5;
        }
        
        .admin-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }
        
        .admin-card {
            background: var(--branco);
            padding: 25px;
            border-radius: 12px;
            box-shadow: var(--sombra);
            border-top: 4px solid var(--azul);
            transition: transform 0.3s;
        }
        
        .admin-card:hover {
            transform: translateY(-5px);
        }
        
        .contato-info {
            display: none;
            background: #e8f4fc;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            border-left: 4px solid var(--azul);
        }
        
        .login-container {
            max-width: 450px;
            margin: 0 auto;
            padding: 30px;
            background: var(--branco);
            border-radius: 16px;
            box-shadow: var(--sombra);
        }
        
        .center {
            text-align: center;
        }
        
        .hidden {
            display: none;
        }
        
        .visible {
            display: block;
        }
        
        .info-box {
            background: #e7f5ff;
            border-left: 4px solid var(--azul);
            padding: 16px;
            margin: 20px 0;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .offline-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 18px;
            border-radius: 8px;
            font-weight: 500;
            z-index: 1000;
            box-shadow: var(--sombra);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .online {
            background: var(--verde);
            color: white;
        }
        
        .offline {
            background: #dc3545;
            color: white;
        }
        
        .edit-form {
            background: rgba(255, 204, 0, 0.05);
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            border: 2px dashed var(--amarelo);
        }
        
        .user-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: rgba(255, 255, 255, 0.15);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            margin-left: 15px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .logo-icon {
            font-size: 28px;
            color: var(--amarelo);
        }
        
        .user-list {
            margin-top: 20px;
        }
        
        .user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }
        
        .user-item:last-child {
            border-bottom: none;
        }
        
        .search-box {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }
        
        .search-box input {
            flex: 1;
        }
        
        .local-details {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .evento-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .evento-item:last-child {
            border-bottom: none;
        }
        
        @media (max-width: 768px) {
            header {
                flex-direction: column;
                text-align: center;
                padding: 15px;
            }
            
            nav {
                justify-content: center;
                margin-top: 15px;
                width: 100%;
            }
            
            nav a {
                flex: 1;
                justify-content: center;
                min-width: 120px;
            }
            
            .admin-panel {
                grid-template-columns: 1fr;
            }
            
            table {
                font-size: 14px;
            }
            
            th, td {
                padding: 12px 10px;
            }
            
            .content {
                padding: 20px;
            }
            
            .offline-status {
                top: 10px;
                right: 10px;
                left: 10px;
                text-align: center;
                justify-content: center;
            }
            
            h1 {
                font-size: 22px;
            }
            
            .user-badge {
                margin: 10px 0 0 0;
            }
            
            .user-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .search-box {
                flex-direction: column;
            }
            
            .evento-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div id="offlineStatus" class="offline-status hidden"><i class="fas fa-wifi"></i> Modo Offline</div>
    
    <div class="container">
        <!-- Página de Login -->
        <div id="loginPage" class="content visible">
            <div class="login-container">
                <div class="center logo">
                    <i class="fas fa-database logo-icon"></i>
                    <h1 style="color: var(--azul);">Sistema de Cadastro</h1>
                </div>
                <p class="center" style="margin-bottom: 25px; color: #666;">Área restrita para usuários autorizados</p>
                
                <form id="loginForm">
                    <div class="form-group">
                        <label for="loginEmail"><i class="fas fa-envelope"></i> Email:</label>
                        <input type="email" id="loginEmail" placeholder="Seu email" required>
                    </div>
                    <div class="form-group">
                        <label for="loginSenha"><i class="fas fa-lock"></i> Senha:</label>
                        <input type="password" id="loginSenha" placeholder="Sua senha" required>
                    </div>
                    <div class="form-group center">
                        <button type="submit"><i class="fas fa-sign-in-alt"></i> Entrar</button>
                    </div>
                </form>
                
                <div class="info-box">
                    <p><strong><i class="fas fa-info-circle"></i> Acesso restrito</strong></p>
                    <p>Entre em contato com o administrador para obter acesso ao sistema.</p>
                </div>
            </div>
        </div>

        <!-- Página de Cadastro de Usuário (apenas para administradores) -->
        <div id="cadastroPage" class="content hidden">
            <header>
                <div>
                    <h1><i class="fas fa-user-plus"></i> Gerenciar Usuários</h1>
                    <div class="user-badge">
                        <i class="fas fa-user"></i>
                        <span id="currentUser"></span>
                    </div>
                </div>
                <nav>
                    <a href="#" onclick="mostrarPagina('tabelaPage')"><i class="fas fa-table"></i> Ver Locais</a>
                    <a href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Sair</a>
                </nav>
            </header>
            
            <div class="card">
                <h2>Adicionar Novo Usuário</h2>
                <form id="cadastroUserForm">
                    <div class="form-group">
                        <label for="cadastroEmail">Email:</label>
                        <input type="email" id="cadastroEmail" placeholder="Email do novo usuário" required>
                    </div>
                    <div class="form-group">
                        <label for="cadastroSenha">Senha:</label>
                        <input type="password" id="cadastroSenha" placeholder="Senha para o usuário" required>
                    </div>
                    <div class="form-group">
                        <label for="confirmarSenha">Confirmar Senha:</label>
                        <input type="password" id="confirmarSenha" placeholder="Repita a senha" required>
                    </div>
                    <div class="form-group center">
                        <button type="submit"><i class="fas fa-user-plus"></i> Cadastrar Usuário</button>
                    </div>
                </form>
            </div>

            <div class="card">
                <h2>Usuários Cadastrados</h2>
                <div id="listaUsuarios" class="user-list">
                    <!-- Lista de usuários será preenchida via JavaScript -->
                </div>
            </div>
        </div>

        <!-- Página de Área de Cadastro de Locais -->
        <div id="areaCadastroPage" class="content hidden">
            <header>
                <div>
                    <h1><i class="fas fa-plus-circle"></i> Cadastro de Locais</h1>
                    <div class="user-badge">
                        <i class="fas fa-user"></i>
                        <span id="currentUser2"></span>
                    </div>
                </div>
                <nav>
                    <a href="#" onclick="mostrarPagina('tabelaPage')"><i class="fas fa-table"></i> Ver Locais</a>
                    <a href="#" onclick="mostrarPagina('adminPage')"><i class="fas fa-database"></i> Backup</a>
                    <a href="#" onclick="mostrarPagina('cadastroPage')" id="adminLink" class="hidden"><i class="fas fa-users-cog"></i> Admin</a>
                    <a href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Sair</a>
                </nav>
            </header>
            
            <div class="card">
                <div class="info-box">
                    <p><strong><i class="fas fa-lightbulb"></i> Dica:</strong> Seus dados são salvos automaticamente.</p>
                </div>
                
                <h2>Novo Local</h2>
                <form id="cadastroLocalForm">
                    <div class="form-group">
                        <label for="nomeLocal">Nome do Local:</label>
                        <input type="text" id="nomeLocal" required placeholder="Digite o nome do local (ex: Quadra da Escola X)">
                    </div>
                    
                    <div class="form-group">
                        <label for="enderecoLocal">Endereço:</label>
                        <input type="text" id="enderecoLocal" required placeholder="Digite o endereço completo">
                    </div>
                    
                    <div class="form-group">
                        <label for="responsavelLocal">Responsável pelo Local:</label>
                        <input type="text" id="responsavelLocal" required placeholder="Nome do responsável">
                    </div>
                    
                    <div class="form-group">
                        <label for="contatoLocal">Contato do Responsável:</label>
                        <textarea id="contatoLocal" rows="3" placeholder="Telefone, email ou outras informações de contato"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="capacidadeLocal">Capacidade:</label>
                        <input type="number" id="capacidadeLocal" placeholder="Número de pessoas (opcional)">
                    </div>
                    
                    <button type="submit"><i class="fas fa-plus"></i> Adicionar Local</button>
                </form>
                
                <div id="mensagem"></div>
            </div>

            <div class="card">
                <h2>Adicionar Evento a um Local</h2>
                <form id="cadastroEventoForm">
                    <div class="form-group">
                        <label for="localEvento">Selecionar Local:</label>
                        <select id="localEvento" required>
                            <option value="">Selecione um local</option>
                            <!-- Opções serão preenchidas via JavaScript -->
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="escolaEvento">Nome da Escola/Grupo:</label>
                        <input type="text" id="escolaEvento" required placeholder="Digite o nome da escola ou grupo">
                    </div>
                    
                    <div class="form-group">
                        <label for="dataEvento">Data:</label>
                        <input type="date" id="dataEvento" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="horarioInicio">Horário de Início:</label>
                        <input type="time" id="horarioInicio" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="horarioFim">Horário de Término:</label>
                        <input type="time" id="horarioFim" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="responsavelEvento">Responsável pelo Evento:</label>
                        <input type="text" id="responsavelEvento" required placeholder="Nome do responsável">
                    </div>
                    
                    <div class="form-group">
                        <label for="contatoEvento">Contato do Responsável:</label>
                        <textarea id="contatoEvento" rows="3" placeholder="Telefone, email ou outras informações de contato"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="observacoesEvento">Observações:</label>
                        <textarea id="observacoesEvento" rows="3" placeholder="Informações adicionais (opcional)"></textarea>
                    </div>
                    
                    <button type="submit"><i class="fas fa-plus"></i> Adicionar Evento</button>
                </form>
            </div>
        </div>

        <!-- Página da Tabela de Locais -->
        <div id="tabelaPage" class="content hidden">
            <header>
                <div>
                    <h1><i class="fas fa-list-alt"></i> Locais Cadastrados</h1>
                    <div class="user-badge">
                        <i class="fas fa-user"></i>
                        <span id="currentUser3"></span>
                    </div>
                </div>
                <nav>
                    <a href="#" onclick="mostrarPagina('areaCadastroPage')"><i class="fas fa-plus-circle"></i> Adicionar</a>
                    <a href="#" onclick="mostrarPagina('adminPage')"><i class="fas fa-database"></i> Backup</a>
                    <a href="#" onclick="mostrarPagina('cadastroPage')" id="adminLink2" class="hidden"><i class="fas fa-users-cog"></i> Admin</a>
                    <a href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Sair</a>
                </nav>
            </header>
            
            <div class="card">
                <div class="info-box">
                    <p><strong><i class="fas fa-info-circle"></i> Instruções:</strong> Clique em um local para ver os eventos agendados.</p>
                </div>
                
                <h2>Locais Cadastrados</h2>
                
                <div class="search-box">
                    <input type="text" id="pesquisaLocal" placeholder="Pesquisar local por nome..." onkeyup="filtrarLocais()">
                    <button onclick="limparPesquisa()"><i class="fas fa-times"></i> Limpar</button>
                </div>
                
                <div class="table-container">
                    <table id="tabelaLocais">
                        <thead>
                            <tr>
                                <th>Local</th>
                                <th>Endereço</th>
                                <th>Responsável</th>
                                <th>Eventos Agendados</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Os locais serão inseridos aqui via JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <div id="detalhesLocal" class="local-details hidden">
                    <h3>Eventos no Local: <span id="nomeLocalDetalhes"></span></h3>
                    <div id="listaEventos">
                        <!-- Lista de eventos será preenchida via JavaScript -->
                    </div>
                    <button onclick="fecharDetalhes()" class="btn-cancel"><i class="fas fa-arrow-left"></i> Voltar</button>
                </div>
            </div>
        </div>

        <!-- Página de Administração -->
        <div id="adminPage" class="content hidden">
            <header>
                <div>
                    <h1><i class="fas fa-database"></i> Administração - Backup de Dados</h1>
                    <div class="user-badge">
                        <i class="fas fa-user"></i>
                        <span id="currentUser4"></span>
                    </div>
                </div>
                <nav>
                    <a href="#" onclick="mostrarPagina('tabelaPage')"><i class="fas fa-arrow-left"></i> Voltar</a>
                    <a href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Sair</a>
                </nav>
            </header>

            <div class="card">
                <div class="info-box">
                    <p><strong><i class="fas fa-exclamation-triangle"></i> Backup é essencial!</strong> Faça backup regularmente para garantir que não perca seus dados.</p>
                </div>
            </div>

            <div class="admin-panel">
                <div class="admin-card">
                    <h2><i class="fas fa-file-export"></i> Criar Backup (JSON)</h2>
                    <p>Salva todos os dados em formato JSON para backup</p>
                    <div class="form-group">
                        <label for="backupName">Nome do arquivo:</label>
                        <input type="text" id="backupName" placeholder="Nome do backup" value="backup-dados">
                    </div>
                    <button onclick="fazerBackupJSON()" class="btn-backup"><i class="fas fa-download"></i> Criar Backup JSON</button>
                </div>

                <div class="admin-card">
                    <h2><i class="fas fa-file-excel"></i> Exportar para Excel</h2>
                    <p>Exporta todos os registros para planilha Excel (XLSX)</p>
                    <button onclick="exportarParaExcel()" class="btn-export"><i class="fas fa-file-export"></i> Exportar para Excel</button>
                </div>

                <div class="admin-card">
                    <h2><i class="fas fa-file-import"></i> Restaurar Backup</h2>
                    <p>Restaura os dados a partir de um arquivo JSON</p>
                    <div class="form-group">
                        <label for="restoreFile">Selecionar arquivo JSON:</label>
                        <input type="file" id="restoreFile" accept=".json">
                    </div>
                    <button onclick="restaurarBackup()" class="btn-info"><i class="fas fa-upload"></i> Restaurar Dados</button>
                </div>
            </div>

            <div class="card">
                <h2><i class="fas fa-chart-bar"></i> Estatísticas do Sistema</h2>
                <div id="estatisticas">
                    <p>Carregando estatísticas...</p>
                </div>
                
                <div id="backupStatus" class="info-box">
                    <p><strong>Status de backup:</strong> Nenhum backup realizado recentemente.</p>
                </div>
            </div>
        </div>
    </div>

    <script>

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // Variáveis globais
        let locais = [];
        let eventos = [];
        let usuarios = [];
        let usuarioLogado = null;
        let ultimoBackup = null;
        let isOnline = true;
        let localEditando = null;
        let localSelecionado = null;

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar status de conexão
            verificarConexao();
            window.addEventListener('online', verificarConexao);
            window.addEventListener('offline', verificarConexao);
            
            // Configurar formulários
            document.getElementById('loginForm').addEventListener('submit', fazerLogin);
            document.getElementById('cadastroUserForm').addEventListener('submit', cadastrarUsuario);
            document.getElementById('cadastroLocalForm').addEventListener('submit', adicionarLocal);
            document.getElementById('cadastroEventoForm').addEventListener('submit', adicionarEvento);
            
            // Configurar data atual como padrão
            document.getElementById('dataEvento').valueAsDate = new Date();
            
            // Verificar se há usuário logado
            const usuarioSalvo = localStorage.getItem('usuarioLogado');
            if (usuarioSalvo) {
                usuarioLogado = JSON.parse(usuarioSalvo);
                atualizarInterfaceUsuario();
                mostrarPagina('tabelaPage');
                carregarLocais();
                atualizarEstatisticas();
                verificarBackupStatus();
            }
        });

        // Carregar dados do Firebase
        async function carregarDados() {
            try {
                // Carregar locais
                const locaisSnapshot = await db.collection('locais').get();
                locais = locaisSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                // Carregar eventos
                const eventosSnapshot = await db.collection('eventos').get();
                eventos = eventosSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                // Carregar usuários
                const usuariosSnapshot = await db.collection('usuarios').get();
                usuarios = usuariosSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                // Se não houver usuários, criar o admin padrão
                if (usuarios.length === 0) {
                    await criarUsuarioPadrao();
                }
                
                // Atualizar selects de locais
                atualizarSelectLocais();
                
            } catch (error) {
                console.error("Erro ao carregar dados:", error);
                mostrarMensagem("Erro ao carregar dados. Verifique sua conexão.", "erro");
                
                // Usar dados locais em caso de falha
                locais = JSON.parse(localStorage.getItem('locais')) || [];
                eventos = JSON.parse(localStorage.getItem('eventos')) || [];
                usuarios = JSON.parse(localStorage.getItem('usuarios')) || [];
                ultimoBackup = localStorage.getItem('ultimoBackup');
            }
        }

        // Criar usuário padrão (admin) se não existir
        async function criarUsuarioPadrao() {
            try {
                const adminUser = {
                    email: "admin@exemplo.com",
                    senha: "123456",
                    criadoEm: new Date().toISOString()
                };
                
                await db.collection('usuarios').add(adminUser);
                usuarios.push(adminUser);
            } catch (error) {
                console.error("Erro ao criar usuário padrão:", error);
            }
        }

        // Atualizar interface com informações do usuário
        function atualizarInterfaceUsuario() {
            if (usuarioLogado) {
                document.querySelectorAll('#currentUser, #currentUser2, #currentUser3, #currentUser4').forEach(el => {
                    el.textContent = usuarioLogado.email;
                });
                
                // Mostrar link de admin apenas para o administrador
                if (usuarioLogado.email === "admin@exemplo.com") {
                    document.querySelectorAll('#adminLink, #adminLink2').forEach(el => {
                        el.classList.remove('hidden');
                    });
                    carregarListaUsuarios();
                }
            }
        }

        // Atualizar select de locais no formulário de eventos
        function atualizarSelectLocais() {
            const select = document.getElementById('localEvento');
            select.innerHTML = '<option value="">Selecione um local</option>';
            
            locais.forEach(local => {
                const option = document.createElement('option');
                option.value = local.id;
                option.textContent = local.nome;
                select.appendChild(option);
            });
        }

        // Verificar status de conexão
        function verificarConexao() {
            isOnline = navigator.onLine;
            const statusElement = document.getElementById('offlineStatus');
            
            if (isOnline) {
                statusElement.innerHTML = '<i class="fas fa-wifi"></i> Modo Online';
                statusElement.className = 'offline-status online';
                statusElement.classList.remove('hidden');
                setTimeout(() => {
                    statusElement.classList.add('hidden');
                }, 3000);
            } else {
                statusElement.innerHTML = '<i class="fas fa-wifi-slash"></i> Modo Offline - Trabalhando localmente';
                statusElement.className = 'offline-status offline';
                statusElement.classList.remove('hidden');
            }
        }

        // Funções de navegação
        function mostrarPagina(paginaId) {
            document.querySelectorAll('.content').forEach(pagina => {
                pagina.classList.remove('visible');
                pagina.classList.add('hidden');
            });
            document.getElementById(paginaId).classList.remove('hidden');
            document.getElementById(paginaId).classList.add('visible');
            
            if (paginaId === 'tabelaPage') {
                carregarLocais();
            } else if (paginaId === 'adminPage') {
                atualizarEstatisticas();
                verificarBackupStatus();
            } else if (paginaId === 'cadastroPage' && usuarioLogado?.email === "admin@exemplo.com") {
                carregarListaUsuarios();
            } else if (paginaId === 'areaCadastroPage') {
                atualizarSelectLocais();
            }
            
            // Limpar edição se estiver saindo da tabela
            if (paginaId !== 'tabelaPage' && localEditando) {
                cancelarEdicao();
            }
        }

        function logout() {
            auth.signOut();
            usuarioLogado = null;
            localStorage.removeItem('usuarioLogado');
            mostrarPagina('loginPage');
        }

        // Funções de autenticação
        async function fazerLogin(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const senha = document.getElementById('loginSenha').value;
            
            try {
                // Tentar autenticar com Firebase Auth
                const userCredential = await auth.signInWithEmailAndPassword(email, senha);
                usuarioLogado = userCredential.user;
                
                // Salvar informações do usuário
                localStorage.setItem('usuarioLogado', JSON.stringify({
                    email: usuarioLogado.email,
                    uid: usuarioLogado.uid
                }));
                
                // Carregar dados do sistema
                await carregarDados();
                
                atualizarInterfaceUsuario();
                mostrarMensagem('Login realizado com sucesso!', 'sucesso');
                setTimeout(() => {
                    mostrarPagina('tabelaPage');
                    carregarLocais();
                    verificarNecessidadeBackup();
                }, 1000);
            } catch (error) {
                console.error("Erro no login:", error);
                mostrarMensagem('Email ou senha incorretos!', 'erro');
            }
        }

        async function cadastrarUsuario(e) {
            e.preventDefault();
            
            // Verificar se o usuário atual é o administrador
            if (usuarioLogado.email !== "admin@exemplo.com") {
                mostrarMensagem('Apenas o administrador pode cadastrar novos usuários!', 'erro');
                return;
            }
            
            const email = document.getElementById('cadastroEmail').value;
            const senha = document.getElementById('cadastroSenha').value;
            const confirmarSenha = document.getElementById('confirmarSenha').value;
            
            if (senha !== confirmarSenha) {
                mostrarMensagem('As senhas não coincidem!', 'erro');
                return;
            }
            
            try {
                // Criar usuário no Firebase Auth
                const userCredential = await auth.createUserWithEmailAndPassword(email, senha);
                
                // Salvar informações adicionais no Firestore
                await db.collection('usuarios').add({
                    email: email,
                    criadoEm: new Date().toISOString(),
                    criadoPor: usuarioLogado.email
                });
                
                mostrarMensagem('Usuário cadastrado com sucesso!', 'sucesso');
                document.getElementById('cadastroUserForm').reset();
                carregarListaUsuarios();
            } catch (error) {
                console.error("Erro ao cadastrar usuário:", error);
                mostrarMensagem('Erro ao cadastrar usuário: ' + error.message, 'erro');
            }
        }

        // Carregar lista de usuários para administrador
        async function carregarListaUsuarios() {
            const listaUsuarios = document.getElementById('listaUsuarios');
            listaUsuarios.innerHTML = '';
            
            try {
                const usuariosSnapshot = await db.collection('usuarios').get();
                const usuariosList = usuariosSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                if (usuariosList.length === 0) {
                    listaUsuarios.innerHTML = '<p>Nenhum usuário cadastrado.</p>';
                    return;
                }
                
                usuariosList.forEach(usuario => {
                    if (usuario.email === "admin@exemplo.com") return; // Não mostrar admin na lista
                    
                    const userItem = document.createElement('div');
                    userItem.className = 'user-item';
                    userItem.innerHTML = `
                        <div>
                            <strong>${usuario.email}</strong>
                        </div>
                        <div>
                            <button class="btn-delete" onclick="excluirUsuario('${usuario.id}')">
                                <i class="fas fa-trash"></i> Excluir
                            </button>
                        </div>
                    `;
                    
                    listaUsuarios.appendChild(userItem);
                });
            } catch (error) {
                console.error("Erro ao carregar usuários:", error);
                listaUsuarios.innerHTML = '<p>Erro ao carregar lista de usuários.</p>';
            }
        }

        // Excluir usuário
        async function excluirUsuario(userId) {
            if (confirm(`Tem certeza que deseja excluir este usuário?`)) {
                try {
                    await db.collection('usuarios').doc(userId).delete();
                    carregarListaUsuarios();
                    mostrarMensagem('Usuário excluído com sucesso!', 'sucesso');
                } catch (error) {
                    console.error("Erro ao excluir usuário:", error);
                    mostrarMensagem('Erro ao excluir usuário.', 'erro');
                }
            }
        }

        // Funções de CRUD para locais
        async function adicionarLocal(e) {
            e.preventDefault();
            
            const novoLocal = {
                nome: document.getElementById('nomeLocal').value,
                endereco: document.getElementById('enderecoLocal').value,
                responsavel: document.getElementById('responsavelLocal').value,
                contato: document.getElementById('contatoLocal').value,
                capacidade: document.getElementById('capacidadeLocal').value || null,
                dataCriacao: new Date().toISOString(),
                criadoPor: usuarioLogado.email
            };
            
            try {
                // Salvar no Firebase
                const docRef = await db.collection('locais').add(novoLocal);
                novoLocal.id = docRef.id;
                
                // Adicionar à lista local
                locais.push(novoLocal);
                
                document.getElementById('cadastroLocalForm').reset();
                mostrarMensagem('Local adicionado com sucesso!', 'sucesso');
                
                // Atualizar select de locais
                atualizarSelectLocais();
            } catch (error) {
                console.error("Erro ao adicionar local:", error);
                mostrarMensagem('Erro ao adicionar local.', 'erro');
            }
        }

        async function adicionarEvento(e) {
            e.preventDefault();
            
            const localId = document.getElementById('localEvento').value;
            const localSelecionado = locais.find(l => l.id === localId);
            
            if (!localSelecionado) {
                mostrarMensagem('Selecione um local válido.', 'erro');
                return;
            }
            
            const horarioInicio = document.getElementById('horarioInicio').value;
            const horarioFim = document.getElementById('horarioFim').value;
            
            // Verificar se horário de término é após horário de início
            if (horarioFim <= horarioInicio) {
                mostrarMensagem('O horário de término deve ser após o horário de início.', 'erro');
                return;
            }
            
            const novoEvento = {
                localId: localId,
                localNome: localSelecionado.nome,
                escola: document.getElementById('escolaEvento').value,
                data: document.getElementById('dataEvento').value,
                horarioInicio: horarioInicio,
                horarioFim: horarioFim,
                responsavel: document.getElementById('responsavelEvento').value,
                contato: document.getElementById('contatoEvento').value,
                observacoes: document.getElementById('observacoesEvento').value || '',
                dataCriacao: new Date().toISOString(),
                criadoPor: usuarioLogado.email
            };
            
            try {
                // Salvar no Firebase
                const docRef = await db.collection('eventos').add(novoEvento);
                novoEvento.id = docRef.id;
                
                // Adicionar à lista local
                eventos.push(novoEvento);
                
                document.getElementById('cadastroEventoForm').reset();
                document.getElementById('dataEvento').valueAsDate = new Date();
                
                mostrarMensagem('Evento adicionado com sucesso!', 'sucesso');
            } catch (error) {
                console.error("Erro ao adicionar evento:", error);
                mostrarMensagem('Erro ao adicionar evento.', 'erro');
            }
        }

        function carregarLocais() {
            const tbody = document.querySelector('#tabelaLocais tbody');
            tbody.innerHTML = '';
            
            if (locais.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center;">Nenhum local encontrado.</td></tr>';
                return;
            }
            
            // Ordenar locais por nome
            const locaisOrdenados = [...locais].sort((a, b) => 
                a.nome.localeCompare(b.nome)
            );
            
            locaisOrdenados.forEach(local => {
                const tr = document.createElement('tr');
                
                // Contar eventos para este local
                const eventosLocal = eventos.filter(e => e.localId === local.id);
                
                tr.innerHTML = `
                    <td>${local.nome}</td>
                    <td>${local.endereco}</td>
                    <td>${local.responsavel}</td>
                    <td>${eventosLocal.length} evento(s)</td>
                    <td>
                        <button class="btn-info" onclick="verDetalhesLocal('${local.id}')"><i class="fas fa-info-circle"></i> Detalhes</button>
                        <button class="btn-edit" onclick="editarLocal('${local.id}')"><i class="fas fa-edit"></i> Editar</button>
                        <button class="btn-delete" onclick="excluirLocal('${local.id}')"><i class="fas fa-trash"></i> Excluir</button>
                    </td>
                `;
                
                tbody.appendChild(tr);
            });
        }

        function filtrarLocais() {
            const termo = document.getElementById('pesquisaLocal').value.toLowerCase();
            const linhas = document.querySelectorAll('#tabelaLocais tbody tr');
            
            linhas.forEach(linha => {
                const nomeLocal = linha.cells[0].textContent.toLowerCase();
                if (nomeLocal.includes(termo)) {
                    linha.style.display = '';
                } else {
                    linha.style.display = 'none';
                }
            });
        }

        function limparPesquisa() {
            document.getElementById('pesquisaLocal').value = '';
            filtrarLocais();
        }

        async function verDetalhesLocal(localId) {
            localSelecionado = locais.find(l => l.id === localId);
            if (!localSelecionado) return;
            
            // Mostrar nome do local
            document.getElementById('nomeLocalDetalhes').textContent = localSelecionado.nome;
            
            // Carregar eventos deste local
            const eventosLocal = eventos.filter(e => e.localId === localId);
            
            const listaEventos = document.getElementById('listaEventos');
            listaEventos.innerHTML = '';
            
            if (eventosLocal.length === 0) {
                listaEventos.innerHTML = '<p>Nenhum evento agendado para este local.</p>';
            } else {
                // Ordenar eventos por data e horário
                eventosLocal.sort((a, b) => {
                    const dataA = new Date(a.data + 'T' + a.horarioInicio);
                    const dataB = new Date(b.data + 'T' + b.horarioInicio);
                    return dataA - dataB;
                });
                
                eventosLocal.forEach(evento => {
                    const eventoItem = document.createElement('div');
                    eventoItem.className = 'evento-item';
                    
                    const dataEvento = new Date(evento.data);
                    const dataFormatada = dataEvento.toLocaleDateString('pt-BR');
                    
                    eventoItem.innerHTML = `
                        <div>
                            <strong>${evento.escola}</strong><br>
                            <span>${dataFormatada} - ${evento.horarioInicio} às ${evento.horarioFim}</span><br>
                            <span>Responsável: ${evento.responsavel}</span>
                        </div>
                        <div>
                            <button class="btn-info" onclick="mostrarContatoEvento('${evento.id}')"><i class="fas fa-address-card"></i> Contato</button>
                            <button class="btn-edit" onclick="editarEvento('${evento.id}')"><i class="fas fa-edit"></i> Editar</button>
                            <button class="btn-delete" onclick="excluirEvento('${evento.id}')"><i class="fas fa-trash"></i> Excluir</button>
                            <div id="contato-evento-${evento.id}" class="contato-info">
                                <strong>Contato:</strong><br>
                                ${evento.contato || 'Nenhum contato informado.'}<br>
                                ${evento.observacoes ? `<strong>Observações:</strong><br>${evento.observacoes}` : ''}
                            </div>
                        </div>
                    `;
                    
                    listaEventos.appendChild(eventoItem);
                });
            }
            
            // Mostrar detalhes e esconder tabela
            document.getElementById('tabelaLocais').classList.add('hidden');
            document.getElementById('detalhesLocal').classList.remove('hidden');
        }

        function fecharDetalhes() {
            document.getElementById('detalhesLocal').classList.add('hidden');
            document.getElementById('tabelaLocais').classList.remove('hidden');
            localSelecionado = null;
        }

        function mostrarContatoEvento(eventoId) {
            const contatoDiv = document.getElementById(`contato-evento-${eventoId}`);
            if (contatoDiv.style.display === 'block') {
                contatoDiv.style.display = 'none';
            } else {
                // Fecha outros contatos abertos
                document.querySelectorAll('.contato-info').forEach(info => {
                    info.style.display = 'none';
                });
                contatoDiv.style.display = 'block';
            }
        }

        function editarLocal(localId) {
            // Implementar edição de local
            mostrarMensagem('Funcionalidade de edição em desenvolvimento.', 'alerta');
        }

        function editarEvento(eventoId) {
            // Implementar edição de evento
            mostrarMensagem('Funcionalidade de edição em desenvolvimento.', 'alerta');
        }

        async function excluirLocal(localId) {
            if (confirm('Tem certeza que deseja excluir este local? Todos os eventos associados também serão excluídos.')) {
                try {
                    // Excluir local do Firebase
                    await db.collection('locais').doc(localId).delete();
                    
                    // Excluir eventos associados
                    const eventosParaExcluir = eventos.filter(e => e.localId === localId);
                    for (const evento of eventosParaExcluir) {
                        await db.collection('eventos').doc(evento.id).delete();
                    }
                    
                    // Atualizar listas locais
                    locais = locais.filter(l => l.id !== localId);
                    eventos = eventos.filter(e => e.localId !== localId);
                    
                    carregarLocais();
                    atualizarEstatisticas();
                    mostrarMensagem('Local excluído com sucesso!', 'sucesso');
                } catch (error) {
                    console.error("Erro ao excluir local:", error);
                    mostrarMensagem('Erro ao excluir local.', 'erro');
                }
            }
        }

        async function excluirEvento(eventoId) {
            if (confirm('Tem certeza que deseja excluir este evento?')) {
                try {
                    // Excluir evento do Firebase
                    await db.collection('eventos').doc(eventoId).delete();
                    
                    // Atualizar lista local
                    eventos = eventos.filter(e => e.id !== eventoId);
                    
                    // Recarregar detalhes se estiverem abertos
                    if (localSelecionado) {
                        verDetalhesLocal(localSelecionado.id);
                    }
                    
                    atualizarEstatisticas();
                    mostrarMensagem('Evento excluído com sucesso!', 'sucesso');
                } catch (error) {
                    console.error("Erro ao excluir evento:", error);
                    mostrarMensagem('Erro ao excluir evento.', 'erro');
                }
            }
        }

        // Funções de backup e exportação
        async function fazerBackupJSON() {
            try {
                const backupName = document.getElementById('backupName').value || 'backup-dados';
                
                // Buscar dados atualizados
                await carregarDados();
                
                const dataStr = JSON.stringify({
                    locais: locais,
                    eventos: eventos,
                    usuarios: usuarios,
                    dataBackup: new Date().toISOString(),
                    versao: '1.0'
                }, null, 2);
                
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                const exportFileDefaultName = `${backupName}-${new Date().toISOString().slice(0,10)}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                
                // Atualizar data do último backup
                ultimoBackup = new Date().toISOString();
                localStorage.setItem('ultimoBackup', ultimoBackup);
                verificarBackupStatus();
                
                mostrarMensagem('Backup JSON criado com sucesso!', 'sucesso');
            } catch (error) {
                console.error("Erro ao criar backup:", error);
                mostrarMensagem('Erro ao criar backup.', 'erro');
            }
        }

        function exportarParaExcel() {
            if (locais.length === 0) {
                mostrarMensagem('Não há dados para exportar!', 'erro');
                return;
            }
            
            // Preparar dados para exportação
            const dadosExportacao = [];
            
            // Adicionar locais
            locais.forEach(local => {
                dadosExportacao.push({
                    'Tipo': 'Local',
                    'Nome': local.nome,
                    'Endereço': local.endereco,
                    'Responsável': local.responsavel,
                    'Contato': local.contato || '',
                    'Capacidade': local.capacidade || '',
                    'Data de Criação': new Date(local.dataCriacao).toLocaleString('pt-BR')
                });
            });
            
            // Adicionar eventos
            eventos.forEach(evento => {
                dadosExportacao.push({
                    'Tipo': 'Evento',
                    'Local': evento.localNome,
                    'Escola/Grupo': evento.escola,
                    'Data': evento.data,
                    'Horário Início': evento.horarioInicio,
                    'Horário Término': evento.horarioFim,
                    'Responsável': evento.responsavel,
                    'Contato': evento.contato || '',
                    'Observações': evento.observacoes || '',
                    'Data de Criação': new Date(evento.dataCriacao).toLocaleString('pt-BR')
                });
            });
            
            // Criar planilha
            const worksheet = XLSX.utils.json_to_sheet(dadosExportacao);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, "Dados");
            
            // Gerar arquivo
            XLSX.writeFile(workbook, `dados-sistema-${new Date().toISOString().slice(0,10)}.xlsx`);
            
            mostrarMensagem('Planilha Excel exportada com sucesso!', 'sucesso');
        }

        async function restaurarBackup() {
            const fileInput = document.getElementById('restoreFile');
            const file = fileInput.files[0];
            
            if (!file) {
                mostrarMensagem('Selecione um arquivo JSON para restaurar!', 'erro');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = async function(e) {
                try {
                    const dados = JSON.parse(e.target.result);
                    
                    if (!dados.locais || !Array.isArray(dados.locais)) {
                        throw new Error('Formato de arquivo inválido');
                    }
                    
                    if (!confirm(`Tem certeza que deseja restaurar ${dados.locais.length} locais e ${dados.eventos?.length || 0} eventos? Todos os dados atuais serão substituídos.`)) {
                        return;
                    }
                    
                    // Limpar dados atuais
                    await limparDadosFirebase();
                    
                    // Restaurar locais
                    for (const local of dados.locais) {
                        await db.collection('locais').add(local);
                    }
                    
                    // Restaurar eventos
                    if (dados.eventos && Array.isArray(dados.eventos)) {
                        for (const evento of dados.eventos) {
                            await db.collection('eventos').add(evento);
                        }
                    }
                    
                    // Restaurar usuários (se houver)
                    if (dados.usuarios && Array.isArray(dados.usuarios)) {
                        for (const usuario of dados.usuarios) {
                            await db.collection('usuarios').add(usuario);
                        }
                    }
                    
                    // Recarregar dados
                    await carregarDados();
                    
                    mostrarMensagem(`Backup restaurado com sucesso! ${dados.locais.length} locais e ${dados.eventos?.length || 0} eventos importados.`, 'sucesso');
                    carregarLocais();
                    atualizarEstatisticas();
                    
                    // Limpar seleção de arquivo
                    fileInput.value = '';
                    
                } catch (error) {
                    console.error(error);
                    mostrarMensagem('Erro ao processar arquivo: ' + error.message, 'erro');
                }
            };
            reader.readAsText(file);
        }

        // Limpar todos os dados do Firebase
        async function limparDadosFirebase() {
            try {
                // Limpar eventos
                const eventosSnapshot = await db.collection('eventos').get();
                for (const doc of eventosSnapshot.docs) {
                    await db.collection('eventos').doc(doc.id).delete();
                }
                
                // Limpar locais
                const locaisSnapshot = await db.collection('locais').get();
                for (const doc of locaisSnapshot.docs) {
                    await db.collection('locais').doc(doc.id).delete();
                }
                
                // Limpar usuários (exceto admin)
                const usuariosSnapshot = await db.collection('usuarios').get();
                for (const doc of usuariosSnapshot.docs) {
                    const usuario = doc.data();
                    if (usuario.email !== "admin@exemplo.com") {
                        await db.collection('usuarios').doc(doc.id).delete();
                    }
                }
            } catch (error) {
                console.error("Erro ao limpar dados:", error);
                throw new Error("Não foi possível limpar os dados atuais");
            }
        }

        function atualizarEstatisticas() {
            const estatisticasDiv = document.getElementById('estatisticas');
            const totalLocais = locais.length;
            const totalEventos = eventos.length;
            
            if (totalLocais === 0) {
                estatisticasDiv.innerHTML = '<p>Nenhum local cadastrado ainda.</p>';
                return;
            }
            
            // Encontrar o local com mais eventos
            let localMaisEventos = null;
            let maxEventos = 0;
            
            for (const local of locais) {
                const eventosLocal = eventos.filter(e => e.localId === local.id).length;
                if (eventosLocal > maxEventos) {
                    maxEventos = eventosLocal;
                    localMaisEventos = local.nome;
                }
            }
            
            estatisticasDiv.innerHTML = `
                <p><strong>Total de locais:</strong> ${totalLocais}</p>
                <p><strong>Total de eventos:</strong> ${totalEventos}</p>
                <p><strong>Local com mais eventos:</strong> ${localMaisEventos} (${maxEventos} eventos)</p>
            `;
        }

        function verificarBackupStatus() {
            const backupStatusDiv = document.getElementById('backupStatus');
            
            if (!ultimoBackup) {
                backupStatusDiv.innerHTML = '<p><strong>Status de backup:</strong> Nenhum backup realizado ainda. É recomendado fazer backup regularmente.</p>';
                backupStatusDiv.className = 'alerta';
                return;
            }
            
            const dataBackup = new Date(ultimoBackup);
            const diasDesdeBackup = Math.floor((new Date() - dataBackup) / (1000 * 60 * 60 * 24));
            
            if (diasDesdeBackup > 7) {
                backupStatusDiv.innerHTML = `<p><strong>Status de backup:</strong> Seu último backup foi há ${diasDesdeBackup} dias. É altamente recomendado fazer um novo backup.</p>`;
                backupStatusDiv.className = 'erro';
            } else if (diasDesdeBackup > 3) {
                backupStatusDiv.innerHTML = `<p><strong>Status de backup:</strong> Seu último backup foi há ${diasDesdeBackup} dias. Considere fazer um novo backup em breve.</p>`;
                backupStatusDiv.className = 'alerta';
            } else {
                backupStatusDiv.innerHTML = `<p><strong>Status de backup:</strong> Seu último backup foi há ${diasDesdeBackup} dias. Está em dia!</p>`;
                backupStatusDiv.className = 'sucesso';
            }
        }

        function verificarNecessidadeBackup() {
            if (!ultimoBackup && locais.length > 5) {
                if (confirm('Você tem vários locais mas ainda não fez backup. Deseja fazer um backup agora?')) {
                    mostrarPagina('adminPage');
                }
            }
        }

        function mostrarMensagem(texto, tipo) {
            // Remover mensagens existentes
            const mensagensExistentes = document.querySelectorAll('.mensagem');
            mensagensExistentes.forEach(msg => msg.remove());
            
            const mensagemDiv = document.createElement('div');
            mensagemDiv.className = `mensagem ${tipo}`;
            
            // Adicionar ícone conforme o tipo
            let icone = '';
            if (tipo === 'sucesso') icone = '<i class="fas fa-check-circle"></i> ';
            if (tipo === 'erro') icone = '<i class="fas fa-exclamation-circle"></i> ';
            if (tipo === 'alerta') icone = '<i class="fas fa-exclamation-triangle"></i> ';
            
            mensagemDiv.innerHTML = icone + texto;
            
            // Adicionar a mensagem no container apropriado
            const container = document.querySelector('.content.visible .card') || document.querySelector('.content.visible');
            container.prepend(mensagemDiv);
            
            // Remover após 5 segundos
            setTimeout(() => {
                if (mensagemDiv.parentNode) {
                    mensagemDiv.remove();
                }
            }, 5000);
        }
    </script>
</body>
</html>
